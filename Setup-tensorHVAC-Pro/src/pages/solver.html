<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 style-src 'self' 'unsafe-inline';
                 script-src 'self'">
  <title>Solver setup</title>
  <link rel="stylesheet" href="../styles/main.css" />
  <style>
    /* Layout & cards (align with other pages) */
    .row { display:flex; gap:10px; align-items:center; }
    .col { flex:1; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; }
    label { font-weight:600; display:block; margin:8px 0 6px; }
    input[type="text"], input[type="number"] {
      width:100%;
      padding:10px 12px;
      border:1px solid #d6d6d6;
      border-radius:10px;
      background:#fff;
    }

    .btn-wide { width: 100%; display: block; }
    .btn-run  { background:#16a34a; color:#fff; border:none; padding:10px 12px; border-radius:10px; cursor:pointer; }
    .secondary { padding:8px 12px; border-radius:10px; border:1px solid #d6d6d6; background:#fafafa; }
    .btn-stop { background:#dc2626; color:#fff; border:none; padding:6px 10px; border-radius:10px; cursor:pointer; font-size:12px; }
    .btn-clear{ background:#6b7280; color:#fff; border:none; padding:8px 10px; border-radius:10px; cursor:pointer; font-size:12px; }
    button:disabled { opacity:.6; cursor:not-allowed; }

    .inline-actions { display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap; }
    .muted { opacity:.75; font-size:12px; }

    /* Log */
    .log-wrap { margin-top: 8px; }
    .log-header {
      display:flex; align-items:center; gap:12px; justify-content:space-between; margin-bottom:6px;
      font-size: 14px; opacity: .85;
    }
    .status-badge {
      display:inline-block; padding:2px 8px; border-radius:999px; background:#e5e7eb; color:#111827; font-size:12px;
    }
    .status-running { background:#d1fae5; color:#065f46; }
    .status-idle     { background:#e5e7eb; color:#111827; }
    .status-failed   { background:#fee2e2; color:#991b1b; }
    .status-done     { background:#e0e7ff; color:#3730a3; }

    #runLog {
      width: 100%;
      height: 260px;
      background: #0b1020;
      color: #e6edf3;
      border-radius: 10px;
      padding: 12px;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.45;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
      white-space: pre-wrap;
    }

    /* --- Editability hardening (like your working page) --- */
    .content {
      position: relative;         /* make z-index apply */
      z-index: 9999;              /* above stray overlays */
      pointer-events: auto !important;
    }
    .content input, .content button, .content select, .content textarea {
      pointer-events: auto !important;
      position: relative;
      z-index: 2;
    }

        /* Small note */
    .note {
      color: #444;
      font-size: 12px;
      margin-top: 10px;
      font-style: italic;
    }

    .btn-CheckRes {
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #c6f0d3; background:linear-gradient(180deg,#effff4,#e6f9ee);
      color:#064e3b; font-weight:700; box-shadow: 0 4px 10px rgba(6,78,59,0.06);
    }
    .btn-CheckRes:hover { filter:brightness(.98); }
  </style>
</head>
<body>

  <a class="user-guide-link" href="https://tensorhvac.com/solver-setup-in-tensorhvac-pro" target="_blank" rel="noopener">User Guide</a>

  <div class="sidebar">
    <h1>tensorHVAC-Pro-2026.1.0</h1>
    <div class="nav">
      <a href="home.html">Home</a>
      <a href="meshing.html">Meshing</a>
      <a href="boundaries.html">Boundaries</a>
      <a href="general.html">General</a>
      <a href="solver.html" class="active">Solver setup</a>
      <a href="help.html">Help</a>
    </div>
    <div style="margin-top:auto; font-size:12px; opacity:.75">© tensorcfd</div>
  </div>

  <div class="main">
    <div class="header">Solver setup</div>
    <div class="content">

      <!-- ControlDict -->
      <div class="card" style="margin-bottom:12px">
        <div class="row" style="gap:16px">
          <div class="col">
            <label>Start time (s)</label>
            <input id="startTime" type="text" placeholder="0" />
          </div>
          <div class="col">
            <label>End time (s)</label>
            <input id="endTime" type="text" placeholder="100" />
          </div>
        </div>
        <div class="row" style="gap:16px; margin-top:8px">
          <div class="col">
            <label>deltaT (s)</label>
            <input id="deltaT" type="text" placeholder="0.5" />
          </div>
          <div class="col">
            <label>writeInterval</label>
            <input id="writeInterval" type="text" placeholder="10" />
          </div>
        </div>
      </div>

      <!-- Parallel -->
      <div class="card" style="margin-bottom:12px">
        <h3 style="margin-top:0">Parallel Running</h3>
        <label>Select your number of Cores</label>
        <input id="nSub" type="number" min="1" placeholder="8" />
      </div>

      <!-- Actions -->
      <div class="row" style="gap:12px; margin-bottom:4px">
        <button id="saveAll"  class="btn-wide secondary">Save solver settings</button>
        <button id="startRun" class="btn-wide btn-run">Start Running</button>
      </div>

     <p class="note">please clear result if you want to re-run your simulation with new mesh or new setup</p>

      <!-- Live log -->
      <div class="row log-wrap">
        <div class="col">
          <div class="log-header">
            <div>
              <span>Run log</span>
              <span id="runStatus" class="status-badge status-idle">Idle</span>
            </div>
            <div class="inline-actions">
              <label class="muted"><input id="autoScroll" type="checkbox" checked /> Auto-scroll</label>
              <button id="stopRun" class="btn-stop" disabled>Stop</button>
              <button id="clearLog" class="secondary">Clear log</button>
              <button id="clearResults" class="btn-clear" title="Remove processor* and time directories">Clear results</button>
            </div>
          </div>
          <pre id="runLog">(no output yet)</pre>
        </div>
      </div>

      <!-- Residual chart -->
<div class="card" style="margin-top:12px">
  <div style="display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:8px">
    <strong>Residuals over iteration</strong>
    <div style="display:flex; gap:8px; align-items:center">
      <label class="muted" style="margin:0">
        Field:
        <select id="residualField" style="margin-left:6px">
          <option value="p_rgh">p_rgh</option>
          <option value="Ux">Ux</option>
          <option value="Uy">Uy</option>
          <option value="Uz">Uz</option>
          <option value="h">h</option>
          <option value="k">k</option>
          <option value="omega">omega</option>
        </select>
      </label>
      <label class="muted" style="margin:0">
        Series:
        <select id="residualSeries" style="margin-left:6px">
          <option value="final">Final</option>
          <option value="initial">Initial</option>
        </select>
      </label>
    </div>
  </div>
  <canvas id="residualChart" width="900" height="260" style="width:100%; height:260px; background:#fff; border:1px solid #e5e7eb; border-radius:10px"></canvas>
  <div class="muted" style="margin-top:6px">Y axis is log₁₀(residual). If multiple solves per step (e.g., pressure correctors), the last value in each step is used.</div>
</div>

      <hr/>

      <!-- Footer navigation -->
      <div class="row" style="justify-content:space-between; margin-top:6px">
        <div style="display:flex; gap:8px; align-items:center">
          <button class="secondary" id="backGeneral">← General</button>
          <button class="btn-CheckRes" id="openResult">Open result (paraView)</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Scripts -->
  <script src="../scripts/solver.js"></script>
  <script src="../scripts/solver-run.js"></script>
</body>
</html>
